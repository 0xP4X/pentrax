<div class="container py-3" style="background: #f8f9fa; border-radius: 18px; max-width: 740px; margin: 2rem auto;">
  <div class="card shadow-lg border-0" style="border-radius: 16px; background: #fff;">
    <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between" style="border-radius: 16px 16px 0 0;">
      <span><i class="fas fa-globe fa-lg me-2"></i><strong>IP: {{ info.ip }}</strong></span>
      <div>
        <form method="post" action="{{ url_for('admin_block_ip') }}" style="display:inline;">
          <input type="hidden" name="ip_address" value="{{ info.ip }}">
          <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Block this IP?');"><i class="fas fa-ban"></i> Block IP</button>
        </form>
        {% if info.device_fingerprint %}
        <form method="post" action="{{ url_for('admin_block_device') }}" style="display:inline;">
          <input type="hidden" name="fingerprint" value="{{ info.device_fingerprint }}">
          <button type="submit" class="btn btn-warning btn-sm ms-2" onclick="return confirm('Block this device fingerprint?');"><i class="fas fa-fingerprint"></i> Block Device</button>
        </form>
        {% endif %}
      </div>
    </div>
    <div class="card-body" style="background: #fff; border-radius: 0 0 16px 16px;">
      <h5 class="mb-3 text-primary fw-bold"><i class="fas fa-search-location"></i> Scan Summary</h5>
      <table class="table table-borderless mb-0 small align-middle">
        <tbody>
          {% if info.hostname %}
          <tr><th class="text-muted">Hostname</th><td class="text-dark">{{ info.hostname }}</td></tr>
          {% endif %}
          {% if info.city or info.region or info.country %}
          <tr><th class="text-muted">Location</th><td class="text-dark">{{ info.city }}, {{ info.region }}, {{ info.country }}</td></tr>
          {% endif %}
          {% if info.loc %}
          <tr><th class="text-muted">Coordinates</th><td class="text-dark">{{ info.loc }}</td></tr>
          {% endif %}
          {% if info.org %}
          <tr><th class="text-muted">Org/ISP</th><td class="text-dark">{{ info.org }}</td></tr>
          {% endif %}
          {% if info.asn %}
          <tr><th class="text-muted">ASN</th><td class="text-dark">{{ info.asn }}</td></tr>
          {% endif %}
          {% if info.ipqs %}
          <tr>
            <th class="text-muted">VPN/Proxy/Tor</th>
            <td>
              {% if info.ipqs.vpn or info.ipqs.proxy or info.ipqs.tor %}
                <span class="badge bg-danger"><i class="fas fa-shield-alt"></i> Yes</span>
              {% else %}
                <span class="badge bg-success"><i class="fas fa-check"></i> No</span>
              {% endif %}
            </td>
          </tr>
          <tr>
            <th class="text-muted">Threat Score</th>
            <td><span class="badge bg-warning text-dark"><i class="fas fa-exclamation-triangle"></i> {{ info.ipqs.fraud_score }}/100</span></td>
          </tr>
          <tr>
            <th class="text-muted">ISP</th>
            <td class="text-dark">{{ info.ipqs.ISP }}</td>
          </tr>
          <tr>
            <th class="text-muted">Connection Type</th>
            <td class="text-dark">{{ info.ipqs.connection_type }}</td>
          </tr>
          <tr>
            <th class="text-muted">Abuse/VPN/Hosting</th>
            <td>
              {% if info.ipqs.abuse_velocity or info.ipqs.hosting_provider %}
                <span class="badge bg-danger"><i class="fas fa-exclamation-circle"></i> Yes</span>
              {% else %}
                <span class="badge bg-success"><i class="fas fa-check"></i> No</span>
              {% endif %}
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
      {% if info.loc %}
        {% set lat, lon = info.loc.split(',') %}
        <div class="mt-4 text-center">
          <iframe width="100%" height="250" frameborder="0" style="border-radius:12px; background:#e9ecef;" src="https://www.openstreetmap.org/export/embed.html?bbox={{ lon|float - 0.05 }},{{ lat|float - 0.05 }},{{ lon|float + 0.05 }},{{ lat|float + 0.05 }}&amp;layer=mapnik&amp;marker={{ lat }},{{ lon }}" allowfullscreen></iframe>
          <div class="small text-muted">Map: <a href="https://www.openstreetmap.org/?mlat={{ lat }}&amp;mlon={{ lon }}#map=12/{{ lat }}/{{ lon }}" target="_blank">OpenStreetMap</a></div>
        </div>
      {% endif %}
      {% if info.device_fingerprint %}
        <hr>
        <div class="mt-3">
          <strong><i class="fas fa-fingerprint"></i> Device Fingerprint:</strong>
          <span class="badge bg-info text-dark">{{ info.device_fingerprint }}</span>
          {% if info.device_info %}
            <div class="mt-2 small text-muted">{{ info.device_info }}</div>
          {% endif %}
        </div>
      {% endif %}
      {% if info.raw_data and info.raw_data.ip_info %}
        <hr>
        <h6 class="text-primary mt-4 mb-2 fw-bold"><i class="fas fa-info-circle"></i> IP Info</h6>
        <table class="table table-sm table-bordered bg-white">
          <tbody>
            {% set ipinfo = info.raw_data.ip_info %}
            {% if ipinfo.country %}<tr><th class="bg-light text-muted">Country</th><td class="text-dark">{{ ipinfo.country }}</td></tr>{% endif %}
            {% if ipinfo.regionName %}<tr><th class="bg-light text-muted">Region</th><td class="text-dark">{{ ipinfo.regionName }}</td></tr>{% endif %}
            {% if ipinfo.city %}<tr><th class="bg-light text-muted">City</th><td class="text-dark">{{ ipinfo.city }}</td></tr>{% endif %}
            {% if ipinfo.isp %}<tr><th class="bg-light text-muted">ISP</th><td class="text-dark">{{ ipinfo.isp }}</td></tr>{% endif %}
            {% if ipinfo.org %}<tr><th class="bg-light text-muted">Org</th><td class="text-dark">{{ ipinfo.org }}</td></tr>{% endif %}
            {% if ipinfo['as'] %}<tr><th class="bg-light text-muted">ASN</th><td class="text-dark">{{ ipinfo['as'] }}</td></tr>{% endif %}
            {% if ipinfo.lat and ipinfo.lon %}
              <tr><th class="bg-light text-muted">Lat/Lon</th><td class="text-dark">{{ ipinfo.lat }}, {{ ipinfo.lon }}</td></tr>
            {% endif %}
            {% if ipinfo.query %}<tr><th class="bg-light text-muted">IP</th><td class="text-dark">{{ ipinfo.query }}</td></tr>{% endif %}
            {% if ipinfo.status %}<tr><th class="bg-light text-muted">Status</th><td class="text-dark">{{ ipinfo.status }}</td></tr>{% endif %}
            {% if ipinfo.zip %}<tr><th class="bg-light text-muted">ZIP</th><td class="text-dark">{{ ipinfo.zip }}</td></tr>{% endif %}
          </tbody>
        </table>
      {% endif %}
      {% if info.error or info.ipinfo_error or info.ipqs_error %}
        <div class="alert alert-danger mt-3">
          <strong>Errors:</strong>
          {{ info.error or '' }} {{ info.ipinfo_error or '' }} {{ info.ipqs_error or '' }}
        </div>
      {% endif %}
    </div>
  </div>
</div> 